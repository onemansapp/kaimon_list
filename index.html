<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è²·ã„ç‰©ãƒ¡ãƒ¢</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f5f5f5;
            max-width: 600px;
            margin: 0 auto;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆToolbaré¢¨ï¼‰ */
        .header {
            background: #4CAF50;
            color: white;
            padding: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .header-title {
            font-size: 20px;
            font-weight: bold;
        }

        .menu-button {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 8px;
        }

        /* ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ */
        .menu-dropdown {
            display: none;
            position: absolute;
            right: 10px;
            top: 60px;
            background: white;
            border-radius: 4px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 1000;
        }

        .menu-dropdown.active {
            display: block;
        }

        .menu-item {
            padding: 16px 24px;
            cursor: pointer;
            border-bottom: 1px solid #e0e0e0;
        }

        .menu-item:hover {
            background: #f5f5f5;
        }

        .menu-item:last-child {
            border-bottom: none;
        }

        /* ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚¿ãƒ– */
        .nav-buttons {
            display: flex;
            background: white;
            border-bottom: 2px solid #e0e0e0;
        }

        .nav-btn {
            flex: 1;
            padding: 12px;
            background: white;
            border: none;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
            color: black;
        }

        .nav-btn.active {
            background: #4CAF50;
            color: white;
        }

        /* å…¥åŠ›ã‚¨ãƒªã‚¢ */
        .input-area {
            background: white;
            padding: 12px;
            display: flex;
            gap: 8px;
            align-items: center;
            border-bottom: 1px solid #e0e0e0;
        }

        .input-box {
            flex: 1;
            min-width: 0;
            padding: 12px;
            font-size: 16px;
            border: 2px solid #ddd;
            border-radius: 8px;
        }

        .add-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #4CAF50;
            color: white;
            border: none;
            font-size: 28px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        /* ç”»é¢ */
        .screen {
            display: none;
            flex-direction: column;
            flex: 1;
            overflow: hidden;
        }

        .screen.active {
            display: flex;
        }

        /* ã‚¢ã‚¤ãƒ†ãƒ ãƒªã‚¹ãƒˆ */
        .item-list {
            flex: 1;
            overflow-y: auto;
            padding: 8px;
        }

        .item {
            background: white;
            padding: 12px;
            margin: 6px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: relative;
            transition: transform 0.3s, opacity 0.3s;
            cursor: move;
            user-select: none;
            touch-action: pan-y;
        }

        .item.completed {
            opacity: 0.5;
            text-decoration: line-through;
            color: #999;
        }

        .item.dragging {
            opacity: 0.5;
            background: #e8f5e9;
        }

        .item.drag-over {
            border-top: 3px solid #4CAF50;
        }

        .item.swiping {
            transition: none;
        }

        /* ä¸€æ‹¬æ¶ˆå»ãƒœã‚¿ãƒ³ */
        .clear-btn {
            margin-top: 12px;
    	    margin-left: 12px;
            margin-right: 12px;
            margin-bottom: 50px;
            padding: 14px;
            background: #ccc;
            color: white;
            border: none;
            border-radius: 24px;
            font-size: 16px;
            cursor: pointer;
        }

        /* ãƒ¢ãƒ¼ãƒ€ãƒ« */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 24px;
            border-radius: 12px;
            max-width: 400px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-buttons {
            display: flex;
            gap: 8px;
            margin-top: 16px;
        }

        .modal-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
        }

        .modal-btn.primary {
            background: #4CAF50;
            color: white;
        }

        .modal-btn.secondary {
            background: #e0e0e0;
        }

        .empty-message {
            text-align: center;
            padding: 40px 20px;
            color: #999;
            font-size: 16px;
        }

        /* ä½¿ã„æ–¹ç”»é¢ */
        .usage-content {
            line-height: 1.8;
        }

        .usage-content h2 {
            margin-top: 20px;
            margin-bottom: 10px;
            color: #4CAF50;
        }

        .usage-content h3 {
            margin-top: 15px;
            margin-bottom: 8px;
            color: #333;
        }

        .usage-content p {
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <div class="header">
        <div class="header-title">è²·ã„ç‰©ãƒ¡ãƒ¢</div>
        <button class="menu-button" onclick="toggleMenu()">â‹®</button>
    </div>

    <!-- ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
    <div class="menu-dropdown" id="menuDropdown">
        <div class="menu-item" onclick="showUsage()">ä½¿ã„æ–¹</div>
    </div>

    <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚¿ãƒ– -->
    <div class="nav-buttons">
        <button class="nav-btn active" onclick="switchScreen('main')">ãƒ¡ã‚¤ãƒ³</button>
        <button class="nav-btn" onclick="switchScreen('registered')">ç™»éŒ²</button>
        <button class="nav-btn" onclick="switchScreen('later')">å¾Œã§è²·ã†</button>
    </div>

    <!-- ãƒ¡ã‚¤ãƒ³ãƒ¡ãƒ¢ç”»é¢ -->
    <div id="main-screen" class="screen active">
        <div class="input-area">
            <input type="text" class="input-box" id="main-input" placeholder="å“ç›®ã‚’è¿½åŠ ï¼ˆã‚¹ãƒšãƒ¼ã‚¹åŒºåˆ‡ã‚Šã§è¤‡æ•°å¯ï¼‰">
            <button class="add-btn" onclick="addItem('main')">+</button>
        </div>
        <div class="item-list" id="main-list"></div>
        <button class="clear-btn" onclick="clearAllItems('main')">ä¸€æ‹¬æ¶ˆå»</button>
    </div>

    <!-- ç™»éŒ²ç”»é¢ -->
    <div id="registered-screen" class="screen">
        <div class="input-area">
            <input type="text" class="input-box" id="registered-input" placeholder="å“ç›®ã‚’è¿½åŠ ï¼ˆã‚¹ãƒšãƒ¼ã‚¹åŒºåˆ‡ã‚Šã§è¤‡æ•°å¯ï¼‰">
            <button class="add-btn" onclick="addItem('registered')">+</button>
        </div>
        <div class="item-list" id="registered-list"></div>
        <button class="clear-btn" onclick="clearAllItems('registered')">ä¸€æ‹¬æ¶ˆå»</button>
    </div>

    <!-- å¾Œã§è²·ã†ç”»é¢ -->
    <div id="later-screen" class="screen">
        <div class="input-area">
            <input type="text" class="input-box" id="later-input" placeholder="å“ç›®ã‚’è¿½åŠ ï¼ˆã‚¹ãƒšãƒ¼ã‚¹åŒºåˆ‡ã‚Šã§è¤‡æ•°å¯ï¼‰">
            <button class="add-btn" onclick="addItem('later')">+</button>
        </div>
        <div class="item-list" id="later-list"></div>
        <button class="clear-btn" onclick="clearAllItems('later')">ä¸€æ‹¬æ¶ˆå»</button>
    </div>

    <!-- å‰Šé™¤ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="confirm-modal" class="modal">
        <div class="modal-content">
            <h3>å‰Šé™¤ç¢ºèª</h3>
            <p id="confirm-message">ã“ã®é …ç›®ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ</p>
            <div class="modal-buttons">
                <button class="modal-btn secondary" onclick="closeConfirmModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                <button class="modal-btn primary" onclick="confirmDelete()">å‰Šé™¤</button>
            </div>
        </div>
    </div>

    <!-- ä½¿ã„æ–¹ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="usage-modal" class="modal">
        <div class="modal-content">
            <div class="usage-content">
                <h2>ğŸ“ åŸºæœ¬æ“ä½œ</h2>
                <h3>å“ç›®ã®è¿½åŠ </h3>
                <p>1. ç”»é¢ä¸Šéƒ¨ã®å…¥åŠ›æ¬„ã«å“åã‚’å…¥åŠ›<br>
                2. ã€Œ+ã€ãƒœã‚¿ãƒ³ã¾ãŸã¯ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã®å®Œäº†ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™<br>
                3. ã‚¹ãƒšãƒ¼ã‚¹ã§åŒºåˆ‡ã‚‹ã¨ã€è¤‡æ•°ã®å“ç›®ã‚’ä¸€åº¦ã«è¿½åŠ ã§ãã¾ã™<br>
                ã€€ä¾‹ï¼šã€Œç‰›ä¹³ åµ ãƒ‘ãƒ³ã€â†’ 3ã¤ã®å“ç›®ã¨ã—ã¦ç™»éŒ²</p>
                
                <h2>ğŸ—‚ï¸ 3ã¤ã®ç”»é¢</h2>
                
                <h3>ğŸ“Œ ãƒ¡ã‚¤ãƒ³</h3>
                <p>ä»Šæ—¥è²·ã†äºˆå®šã®å“ç‰©ã‚’ç®¡ç†ã™ã‚‹ç”»é¢ã§ã™ã€‚</p>
                <p>â€¢ <strong>ãƒ€ãƒ–ãƒ«ã‚¿ãƒƒãƒ—</strong>ï¼šãƒã‚§ãƒƒã‚¯æ¸ˆã¿ã«ã—ã¦ä¸‹éƒ¨ã«ç§»å‹•ï¼ˆè²·ã£ãŸå°ï¼‰<br>
                â€¢ <strong>å·¦ã‚¹ãƒ¯ã‚¤ãƒ—</strong>ï¼šå‰Šé™¤<br>
                â€¢ <strong>å³ã‚¹ãƒ¯ã‚¤ãƒ—</strong>ï¼šã€Œå¾Œã§è²·ã†ã€ã«ç§»å‹•</p>
                
                <h3>ğŸ“‹ ç™»éŒ²</h3>
                <p>ã‚ˆãè²·ã†å“ç‰©ã‚’ç™»éŒ²ã—ã¦ãŠãç”»é¢ã§ã™ã€‚</p>
                <p>â€¢ <strong>å³ã‚¹ãƒ¯ã‚¤ãƒ—</strong>ï¼šãƒ¡ã‚¤ãƒ³ã«ã‚³ãƒ”ãƒ¼ï¼ˆç™»éŒ²ã«ã¯æ®‹ã‚‹ï¼‰<br>
                â€¢ <strong>å·¦ã‚¹ãƒ¯ã‚¤ãƒ—</strong>ï¼šå‰Šé™¤</p>
                
                <h3>â° å¾Œã§è²·ã†</h3>
                <p>ä»Šå›ã¯è²·ã‚ãªã„ã‘ã©ã€è¿‘ã„ã†ã¡ã«è²·ã†ã‹ã‚‚ã—ã‚Œãªã„å“ç‰©ã‚’ä¿ç®¡ã™ã‚‹ç”»é¢ã§ã™ã€‚</p>
                <p>â€¢ <strong>å³ã‚¹ãƒ¯ã‚¤ãƒ—</strong>ï¼šãƒ¡ã‚¤ãƒ³ã«ç§»å‹•<br>
                â€¢ <strong>å·¦ã‚¹ãƒ¯ã‚¤ãƒ—</strong>ï¼šå‰Šé™¤</p>
                
                <h2>ğŸ”„ ä¾¿åˆ©ãªæ©Ÿèƒ½</h2>
                
                <h3>ã‚¢ã‚¤ãƒ†ãƒ ã®ä¸¦ã³æ›¿ãˆ</h3>
                <p>å“ç›®ã‚’<strong>é•·æŠ¼ã—ã—ã¦ãƒ‰ãƒ©ãƒƒã‚°</strong>ã™ã‚‹ã¨ã€å¥½ããªé †ç•ªã«ä¸¦ã³æ›¿ãˆã§ãã¾ã™</p>
                
                <h3>ä¸€æ‹¬æ¶ˆå»</h3>
                <p>å„ç”»é¢ä¸‹éƒ¨ã®ã€Œ<strong>ä¸€æ‹¬æ¶ˆå»</strong>ã€ãƒœã‚¿ãƒ³ã§ã€ãã®ç”»é¢ã®å…¨ã‚¢ã‚¤ãƒ†ãƒ ã‚’å‰Šé™¤</p>
                
                <h2>ğŸ’¡ ä½¿ã„æ–¹ã®ã‚³ãƒ„</h2>
                <p>1. <strong>ç™»éŒ²ç”»é¢ã‚’æ´»ç”¨</strong>ï¼šç‰›ä¹³ã€åµã€ãƒ‘ãƒ³ãªã©ã€é »ç¹ã«è²·ã†ã‚‚ã®ã‚’ç™»éŒ²ã—ã¦ãŠãã¨ä¾¿åˆ©<br>
                2. <strong>å¾Œã§è²·ã†ã‚’æ´»ç”¨</strong>ï¼šã€Œãã®ã†ã¡è²·ã„ãŸã„ã€ã‚‚ã®ã¯å¾Œã§è²·ã†ã«ä¿ç®¡<br>
                3. <strong>ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½</strong>ï¼šè²·ã„ç‰©ä¸­ã¯ãƒ€ãƒ–ãƒ«ã‚¿ãƒƒãƒ—ã§ãƒã‚§ãƒƒã‚¯ã—ã¦ã„ãã¨ã‚ã‹ã‚Šã‚„ã™ã„<br>
                4. <strong>ä¸¦ã³æ›¿ãˆ</strong>ï¼šã‚¹ãƒ¼ãƒ‘ãƒ¼ã®å£²ã‚Šå ´é †ã«ä¸¦ã¹ã¦ãŠãã¨è²·ã„ç‰©ãŒã‚¹ãƒ ãƒ¼ã‚º</p>
                
                <h2>âš ï¸ æ³¨æ„äº‹é …</h2>
                <p>â€¢ å„ç”»é¢ã§åŒã˜å“åã¯1ã¤ã—ã‹ç™»éŒ²ã§ãã¾ã›ã‚“ï¼ˆé‡è¤‡é˜²æ­¢ï¼‰<br>
                â€¢ ã‚¢ãƒ—ãƒªã‚’çµ‚äº†ã—ã¦ã‚‚ãƒ‡ãƒ¼ã‚¿ã¯ä¿å­˜ã•ã‚Œã¾ã™<br>
                â€¢ ã‚¹ãƒ¯ã‚¤ãƒ—æ“ä½œã¯å‹¢ã„ã‚ˆãè¡Œã†ã¨èªè­˜ã•ã‚Œã‚„ã™ã„ã§ã™</p>
            </div>
            <div class="modal-buttons">
                <button class="modal-btn primary" onclick="closeUsage()">é–‰ã˜ã‚‹</button>
            </div>
        </div>
    </div>

    <script>
        let data = {
            main: [],
            registered: [],
            later: []
        };

        let currentScreen = 'main';
        let deleteTarget = null;
        let deleteType = 'single';
        let draggedItem = null;

        // ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
        function loadData() {
            const saved = localStorage.getItem('shoppingMemoData');
            if (saved) {
                data = JSON.parse(saved);
            }
        }

        // ãƒ‡ãƒ¼ã‚¿ä¿å­˜
        function saveData() {
            localStorage.setItem('shoppingMemoData', JSON.stringify(data));
        }

        // ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
        function toggleMenu() {
            const menu = document.getElementById('menuDropdown');
            menu.classList.toggle('active');
        }

        // ãƒ¡ãƒ‹ãƒ¥ãƒ¼å¤–ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
        document.addEventListener('click', (e) => {
            const menu = document.getElementById('menuDropdown');
            const menuButton = document.querySelector('.menu-button');
            if (!menu.contains(e.target) && e.target !== menuButton) {
                menu.classList.remove('active');
            }
        });

        // ä½¿ã„æ–¹è¡¨ç¤º
        function showUsage() {
            document.getElementById('menuDropdown').classList.remove('active');
            document.getElementById('usage-modal').classList.add('active');
        }

        function closeUsage() {
            document.getElementById('usage-modal').classList.remove('active');
        }

        // ç”»é¢åˆ‡ã‚Šæ›¿ãˆ
        function switchScreen(screen) {
            currentScreen = screen;
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            
            document.getElementById(`${screen}-screen`).classList.add('active');
            event.target.classList.add('active');
            
            renderList();
        }

        // ãƒªã‚¹ãƒˆæç”»
        function renderList() {
            const listEl = document.getElementById(`${currentScreen}-list`);
            listEl.innerHTML = '';

            const items = data[currentScreen];
            
            if (items.length === 0) {
                const emptyMsg = document.createElement('div');
                emptyMsg.className = 'empty-message';
                emptyMsg.textContent = 'å“ç›®ãŒã‚ã‚Šã¾ã›ã‚“';
                listEl.appendChild(emptyMsg);
                return;
            }

            // å®Œäº†ã‚¢ã‚¤ãƒ†ãƒ ã‚’å¾Œã‚ã«ä¸¦ã¹æ›¿ãˆï¼ˆå…ƒã®ãƒªã‚¹ãƒˆã‚’ç›´æ¥ä¸¦ã¹æ›¿ãˆã‚‹ï¼‰
            const activeItems = items.filter(item => !item.completed);
            const completedItems = items.filter(item => item.completed);
            
            data[currentScreen] = [...activeItems, ...completedItems];

            data[currentScreen].forEach((item) => {
                const itemEl = document.createElement('div');
                itemEl.className = 'item' + (item.completed ? ' completed' : '');
                itemEl.textContent = item.name;
                itemEl.draggable = true;
                itemEl.dataset.id = item.id;

                setupItemEvents(itemEl, item);
                listEl.appendChild(itemEl);
            });
        }

        // ã‚¢ã‚¤ãƒ†ãƒ ã‚¤ãƒ™ãƒ³ãƒˆè¨­å®š
        function setupItemEvents(el, item) {
            let touchStartX = 0;
            let touchStartY = 0;
            let currentX = 0;
            let lastTap = 0;
            let isDraggingTouch = false;

            // ã‚¿ãƒƒãƒã‚¤ãƒ™ãƒ³ãƒˆï¼ˆã‚¹ãƒ¯ã‚¤ãƒ—ç”¨ï¼‰
            el.addEventListener('touchstart', (e) => {
                touchStartX = e.touches[0].clientX;
                touchStartY = e.touches[0].clientY;
                currentX = 0;
                isDraggingTouch = false;
            });

            el.addEventListener('touchmove', (e) => {
                const deltaX = e.touches[0].clientX - touchStartX;
                const deltaY = e.touches[0].clientY - touchStartY;

                if (Math.abs(deltaX) > Math.abs(deltaY) && Math.abs(deltaX) > 10) {
                    e.preventDefault();
                    currentX = deltaX;
                    el.style.transform = `translateX(${deltaX}px)`;
                    el.classList.add('swiping');
                    isDraggingTouch = true;
                }
            });

            el.addEventListener('touchend', (e) => {
                el.classList.remove('swiping');
                
                if (!isDraggingTouch) {
                    const now = Date.now();
                    if (now - lastTap < 300) {
                        toggleComplete(item.id);
                    }
                    lastTap = now;
                }

                if (Math.abs(currentX) > 100) {
                    if (currentX < 0) {
                        deleteTarget = item.id;
                        deleteType = 'single';
                        document.getElementById('confirm-message').textContent = 'ã“ã®é …ç›®ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ';
                        document.getElementById('confirm-modal').classList.add('active');
                    } else {
                        moveItem(item.id);
                    }
                }
                
                el.style.transform = '';
                isDraggingTouch = false;
            });

            // ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆä¸¦ã³æ›¿ãˆç”¨ï¼‰
            el.addEventListener('dragstart', (e) => {
                draggedItem = item;
                el.classList.add('dragging');
                e.dataTransfer.effectAllowed = 'move';
                e.dataTransfer.setData('text/html', item.id);
            });

            el.addEventListener('dragend', () => {
                el.classList.remove('dragging');
                draggedItem = null;
                document.querySelectorAll('.drag-over').forEach(el => el.classList.remove('drag-over'));
            });

            el.addEventListener('dragover', (e) => {
                e.preventDefault();
                if (!draggedItem) return;
                
                const dragging = document.querySelector('.dragging');
                if (!dragging || dragging === el) return;

                el.classList.add('drag-over');
                
                const listEl = el.parentElement;
                const afterElement = getDragAfterElement(listEl, e.clientY);
                
                if (afterElement == null) {
                    listEl.appendChild(dragging);
                } else if (afterElement !== dragging) {
                    listEl.insertBefore(dragging, afterElement);
                }
            });

            el.addEventListener('dragleave', () => {
                el.classList.remove('drag-over');
            });

            el.addEventListener('drop', (e) => {
                e.preventDefault();
                el.classList.remove('drag-over');
                reorderItems();
            });
        }

        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.item:not(.dragging)')];

            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;

                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        function reorderItems() {
            const listEl = document.getElementById(`${currentScreen}-list`);
            const newOrder = [...listEl.children]
                .filter(el => el.classList.contains('item'))
                .map(el => el.dataset.id);
            data[currentScreen] = newOrder.map(id => data[currentScreen].find(item => item.id === id));
            saveData();
        }

        // å®Œäº†åˆ‡ã‚Šæ›¿ãˆ
        function toggleComplete(id) {
            if (currentScreen !== 'main') return;
            const item = data.main.find(i => i.id === id);
            if (item) {
                item.completed = !item.completed;
                saveData();
                renderList();
            }
        }

        // ã‚¢ã‚¤ãƒ†ãƒ ç§»å‹•
        function moveItem(id) {
            const position = data[currentScreen].findIndex(i => i.id === id);
            if (position === -1) return;
            
            const item = data[currentScreen][position];

            if (currentScreen === 'main') {
                // ãƒ¡ã‚¤ãƒ³ â†’ å¾Œã§è²·ã†ï¼ˆç§»å‹•ï¼‰
                if (!isDuplicateInList(data.later, item.name)) {
                    data.later.push({
                        id: Date.now().toString(),
                        name: item.name,
                        completed: false
                    });
                }
                data[currentScreen].splice(position, 1);
                
            } else if (currentScreen === 'registered') {
                // ç™»éŒ² â†’ ãƒ¡ã‚¤ãƒ³ï¼ˆã‚³ãƒ”ãƒ¼ï¼‰
                if (!isDuplicateInList(data.main, item.name)) {
                    data.main.push({
                        id: Date.now().toString(),
                        name: item.name,
                        completed: false
                    });
                }
                
            } else if (currentScreen === 'later') {
                // å¾Œã§è²·ã† â†’ ãƒ¡ã‚¤ãƒ³ï¼ˆç§»å‹•ï¼‰
                if (!isDuplicateInList(data.main, item.name)) {
                    data.main.push({
                        id: Date.now().toString(),
                        name: item.name,
                        completed: false
                    });
                }
                data[currentScreen].splice(position, 1);
            }
            
            saveData();
            renderList();
        }

        // ã‚¢ã‚¤ãƒ†ãƒ è¿½åŠ 
        function addItem(screen) {
            const input = document.getElementById(`${screen}-input`);
            const text = input.value.trim();
            
            if (text) {
                const items = text.split(/\s+/).filter(name => name.length > 0);
                
                items.forEach(name => {
                    const exists = data[screen].some(item => item.name === name);
                    
                    if (!exists) {
                        data[screen].push({
                            id: Date.now().toString() + Math.random(),
                            name: name,
                            completed: false
                        });
                    }
                });
                
                saveData();
                renderList();
                input.value = '';
                input.focus();
            }
        }

        // é‡è¤‡ãƒã‚§ãƒƒã‚¯
        function isDuplicateInList(list, name) {
            return list.some(item => item.name === name);
        }

        // ä¸€æ‹¬æ¶ˆå»
        function clearAllItems(screen) {
            if (data[screen].length === 0) return;
            
            deleteType = 'all';
            deleteTarget = screen;
            document.getElementById('confirm-message').textContent = 
                `å…¨ã¦ã®å“ç›®ï¼ˆ${data[screen].length}ä»¶ï¼‰ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`;
            document.getElementById('confirm-modal').classList.add('active');
        }

        // å‰Šé™¤ç¢ºèª
        function confirmDelete() {
            if (deleteType === 'single' && deleteTarget) {
                const position = data[currentScreen].findIndex(i => i.id === deleteTarget);
                if (position !== -1) {
                    data[currentScreen].splice(position, 1);
                }
            } else if (deleteType === 'all' && deleteTarget) {
                data[deleteTarget] = [];
            }
            
            saveData();
            renderList();
            closeConfirmModal();
        }

        function closeConfirmModal() {
            document.getElementById('confirm-modal').classList.remove('active');
            deleteTarget = null;
            deleteType = 'single';
        }

        // Enterã‚­ãƒ¼ã§è¿½åŠ 
        document.getElementById('main-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') addItem('main');
        });

        document.getElementById('registered-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') addItem('registered');
        });

        document.getElementById('later-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') addItem('later');
        });

        // åˆæœŸåŒ–
        loadData();
        renderList();
    </script>
</body>
</html>

